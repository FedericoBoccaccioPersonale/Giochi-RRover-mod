<!DOCTYPE html>
<html lang="it">
	<head>
		<meta charset="UTF-8" />
		<title>Cartelle del Repository</title>
		<style>
			body { font-family: sans-serif; padding: 2em; }
			ul { list-style: none; padding-left: 1em; }
			li { margin: 0.3em 0; }
			a { text-decoration: none; color: #007acc; }
		</style>
	</head>
	<body>
		<h1>Cartelle disponibili</h1>
		<ul id="folder-list"></ul>

		<script>
			/*
				Questo dovrebbe essere uno scirpt generico da mettere nella index del proprio progetto usabile su github pages.
				Certo sarebbe tutto molto pi√π facile se js permettesse di leggere il file system, cosa che php fa. O anche se github pages supportasse altri linguaggi oltre a js.

				Funzionamento dello script:
					Questa √® la versione modificata, che lenca tutti i file, piuttosto che le cartelle.
					Solo precisamente i file html e non magari gli htm.
				
				Scopo:
					GitHub pages non consente di visualizzare automaticamente i markdown come file renderizzati, contrarimente a come fa nel repository.
			*/

			function getRepoInfoFromURL()
			{
				const hostMatch = window.location.hostname.match(/^([^\.]+)\.github\.io$/);
				const pathMatch = window.location.pathname.match(/^\/([^\/]+)\/?/);
				const urlParams = new URLSearchParams(window.location.search);

				if (!hostMatch || !pathMatch) return null;

				const owner = hostMatch[1];
				const repo = pathMatch[1];
				const branch = urlParams.get("branch") || "main"; // default a "main"

				return { owner, repo, branch };
			}

			async function fetchRecursive(path, owner, repo, branch)
			{
				const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
				const response = await fetch(apiUrl);
				if (!response.ok) throw new Error(`Errore API: ${response.status}`);

				const items = await response.json();
				const ul = document.createElement("ul");

				for (const item of items)
				{
					const li = document.createElement("li");

					if (item.type === "dir")
					{
						li.innerHTML = `<span class="folder">üìÅ ${item.name}</span>`;
						const subTree = await fetchRecursive(item.path, owner, repo, branch);
						li.appendChild(subTree);
					}
					else if (item.type === "file" && item.name.endsWith(".html"))
					{
						const link = document.createElement("a");
						link.href = `./${item.path}`;
						link.textContent = item.name;
						li.appendChild(link);
					}

					ul.appendChild(li);
				}

				return ul;
			}

			async function buildTree()
			{
				const info = getRepoInfoFromURL();
				if (!info) {document.body.innerHTML = "<p>Impossibile determinare owner e repo dall'URL.</p>";return;}

				const { owner, repo, branch } = info;

				try
				{
					const tree = await fetchRecursive("", owner, repo, branch);
					document.getElementById("folder-list").appendChild(tree);
				}
				catch (error)
				{
					document.body.innerHTML = `<p>Errore nel recupero dei dati: ${error.message}</p>`;
				}
			}

			buildTree();
		</script>
	</body>
</html>
